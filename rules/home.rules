// Imports
import org.openhab.core.library.types.*
import org.openhab.core.persistence.*
import org.openhab.model.script.actions.*

// Global Variables
var int onDuration = 5
var Timer _timerBedroom = null
	
//https://msdn.microsoft.com/en-us/library/windows/desktop/dd319008(v=vs.85).aspx

rule "Bedroom Lamp Controller"
when
    Item iMotionBedroom changed
then
	
	if(iMotionBedroom.state == ON) {
	
		sendCommand(iMotionBedroom, OFF)  
		
		if(iLuxBedroom.state < 400) {
			if(iLampBedroom.state == OFF) {
				sendCommand(iLampBedroom, ON)
			}
	    
	    	if(_timerBedroom != null) {
	    		_timerBedroom.cancel()
	    		_timerBedroom = null
	    	}
	    	
			_timerBedroom = createTimer(now.plusSeconds(onDuration)) [|
			sendCommand(iLampBedroom, OFF)
	  		]
	  	}
  	}
 
end